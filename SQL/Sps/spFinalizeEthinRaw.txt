IF EXISTS (SELECT * FROM sys.objects WHERE type = 'P' AND OBJECT_ID = OBJECT_ID('dbo.spFinalizeEthinRaw'))
   drop proc [dbo].[spFinalizeEthinRaw]
GO
CREATE PROCEDURE [dbo].[spFinalizeEthinRaw] 
AS
BEGIN

  print 'in spFinalizeBcbstAdtRaw'
  declare @myCurrentDateTime [datetime]
  set @myCurrentDateTime = getdate()
  
  truncate table [dbo].[EthinMaster];
  insert into [dbo].[EthinMaster]
  (
    [SummitMrn]
	,[PatientClass]
	,[MessageTime]
	,[LastName]
	,[FirstName]
	,[MiddleName]
	,[Suffix]
	,[Gender]
	,[DateOfBirth]
	,[DateOfDeath]
	,[SendingFacility]
	,[AdmitTime]
	,[DischargeTime]
	,[AttendingProvider]
	,[PrimaryCareProvider]
	,[AdmitSource]
	,[AdmitReason]
	,[DischargeStatus]
	,[FinalDiagnosesList]
	,[Insurance]
		
	,[AdmitOrDischarge]

	,[SourceFullFilename]
	,[LastUpdateTimestamp]
  )
  select
    [SummitMrn]
	,[PatientClass]
	,[MessageTime]
	,[LastName]
	,[FirstName]
	,[MiddleName]
	,[Suffix]
	,[Gender]
	,[DateOfBirth]
	,[DateOfDeath]
	,[SendingFacility]
	,[AdmitTime]
	,[DischargeTime]
	,[AttendingProvider]
	,[PrimaryCareProvider]
	,[AdmitSource]
	,[AdmitReason]
	,[DischargeStatus]
	,[FinalDiagnosesList]
	,[Insurance]
		
	,[AdmitOrDischarge]

	,[SourceFullFilename]
	,[LastUpdateTimestamp]
  from [dbo].[EthinRaw]
 where [DischargeTime] is not null
   and [DischargeTime] <> convert(datetime, '19000101', 112)

  truncate table [dbo].[EthinRaw];
   
  declare @EthinMasterCount [int] = 0  

  declare @IsOk [bit]
  set @IsOk = 1
   
  select @IsOk [IsOk]   
   
END  