IF EXISTS (SELECT * FROM sys.objects WHERE type = 'P' AND OBJECT_ID = OBJECT_ID('dbo.spFinalizeCignaRaw'))
   drop proc [dbo].[spFinalizeCignaRaw]
GO
CREATE PROCEDURE [dbo].[spFinalizeCignaRaw] 
AS
BEGIN

  print 'in spFinalizeBcbstAdtRaw'
  declare @myCurrentDateTime [datetime]
  set @myCurrentDateTime = getdate()
  
  truncate table [dbo].[CignaMaster];
  insert into [dbo].[CignaMaster]
  (
    [PatientLastName]
	,[PatientFirstName]
	,[Gender]
	,[Dob]
	,[PatientIdAmi]
	,[EnterpriseId]
	,[AlignedPhsyicianName]
	,[Npi]
	,[Product]
	,[AlignmentMethod]
	,[SubgroupLevel1]
	,[SubgroupLevel2]
	,[SubgroupLevel3]
	,[PracticeLocation]
	,[CignaPharmacy]
	,[Yhf]
	,[Ipht]
	,[CignaBehavioral]
	,[AccountNumber]
	,[AccountName]
	,[AdmitDate]
	,[NewEntryOnReport]
	,[ProjectedDischargeDate]
	,[ActualDischargeDate]
	,[DischargeStatus]
	,[LengthOfStayInDays]
	,[Diagnosis]
	,[Procedure]
	,[AdmissionAccessDescription]
	,[BedType]
	,[CaseManagementProgram]
	,[Facility]
	,[FacilityState]
	,[AdmittingProvider]
	,[Readmission]
    ,[InitialReportDate]
    ,[AuthorizationNumber]
	,[ReferredDate]
	,[ReferralStatus]
	,[PrimaryDiagnosisDesc]
	,[CaseManagedBy]
	,[CaseId]
	,[IdentificationSource]
	,[OnCurrentPrevise]
	,[OnCurrentGic]
	,[IpAdmissionsInPast12Months]
	,[IpReadmissionsInPast12Months]
	,[TotalMedicalDollarsInPast12Months]
	,[InpatientDollarsInPast12Months]
	,[ErVisitsInPast12Months]
	,[OutOfNetworkDollarsInPast12Months]
	,[ErVisitForSameDiagnosisInPast12Months]
	,[NumOfOfficeVisitsInPast12Months]
	,[LastOfficeVisitDate]
	,[RxDollarsInPast12Months]
	,[RxPast3Months1]
	,[RxPast3Months2]
	,[RxPast3Months3]
	,[RxPast3Months4]
	,[RxPast3Months5]
	,[RxPast3Months6]
	,[RxPast3Months7]
	,[RxPast3Months8]
	,[RxPast3Months9]
	,[RxPast3Months10]
	,[RxPast3Months11]
	,[RxPast3Months12]
	,[AdmitOrDischarge]
	,[SourceFullFilename]
	,[LastUpdateTimestamp]
  )
  select
	[PatientLastName]
	,[PatientFirstName]
	,[Gender]
	,[Dob]
	,[PatientIdAmi]
	,[EnterpriseId]
	,[AlignedPhsyicianName]
	,[Npi]
	,[Product]
	,[AlignmentMethod]
	,[SubgroupLevel1]
	,[SubgroupLevel2]
	,[SubgroupLevel3]
	,[PracticeLocation]
	,[CignaPharmacy]
	,[Yhf]
	,[Ipht]
	,[CignaBehavioral]
	,[AccountNumber]
	,[AccountName]
	,[AdmitDate]
	,[NewEntryOnReport]
	,[ProjectedDischargeDate]
	,[ActualDischargeDate]
	,[DischargeStatus]
	,[LengthOfStayInDays]
	,[Diagnosis]
	,[Procedure]
	,[AdmissionAccessDescription]
	,[BedType]
	,[CaseManagementProgram]
	,[Facility]
	,[FacilityState]
	,[AdmittingProvider]
	,[Readmission]
    ,[InitialReportDate]
    ,[AuthorizationNumber]
	,[ReferredDate]
	,[ReferralStatus]
	,[PrimaryDiagnosisDesc]
	,[CaseManagedBy]
	,[CaseId]
	,[IdentificationSource]
	,[OnCurrentPrevise]
	,[OnCurrentGic]
	,[IpAdmissionsInPast12Months]
	,[IpReadmissionsInPast12Months]
	,[TotalMedicalDollarsInPast12Months]
	,[InpatientDollarsInPast12Months]
	,[ErVisitsInPast12Months]
	,[OutOfNetworkDollarsInPast12Months]
	,[ErVisitForSameDiagnosisInPast12Months]
	,[NumOfOfficeVisitsInPast12Months]
	,[LastOfficeVisitDate]
	,[RxDollarsInPast12Months]
	,[RxPast3Months1]
	,[RxPast3Months2]
	,[RxPast3Months3]
	,[RxPast3Months4]
	,[RxPast3Months5]
	,[RxPast3Months6]
	,[RxPast3Months7]
	,[RxPast3Months8]
	,[RxPast3Months9]
	,[RxPast3Months10]
	,[RxPast3Months11]
	,[RxPast3Months12]
	,[AdmitOrDischarge]
	,[SourceFullFilename]
	,[LastUpdateTimestamp]
  from [dbo].[CignaRaw]
 where [ActualDischargeDate] is not null
   and [ActualDischargeDate] <> convert(datetime, '19000101', 112)

  truncate table [dbo].[CignaRaw];
   
  declare @CignaMasterCount [int] = 0  

  declare @IsOk [bit]
  set @IsOk = 1
   
  select @IsOk [IsOk]   
   
END  